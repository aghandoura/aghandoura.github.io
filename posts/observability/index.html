<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>The Power of Observability &#183; aghandoura.github.com</title><meta name=title content="The Power of Observability &#183; aghandoura.github.com"><meta name=keywords content="Observability,Kubernetes,k8s,Minikube,ELK,Elasticsearch,Kibana,Logstash,Filebeat,Metricbeat,Grafana,Loki,DevOps,"><link rel=canonical href=https://aghandoura.github.io/posts/observability/><link type=text/css rel=stylesheet href=/css/main.bundle.min.6706de0c552273499da9e06fb4658f37650f5118c75246b61cfc9ce006c67daca1f7dbdf4d561f9e4404d394ffac1208070abd76cd195cc80584b8e1c7cfaa3e.css integrity="sha512-ZwbeDFUic0mdqeBvtGWPN2UPURjHUka2HPyc4AbGfayh99vfTVYfnkQE05T/rBIIBwq9ds0ZXMgFhLjhx8+qPg=="><script type=text/javascript src=/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj+e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.41e474f5d66052b313c33b8f56008afac498015b7472d0f2ab78e22c187405fdff125b6735973309e4743b6924ca8c575db297f464c42da8e30ef9daed3b050c.js integrity="sha512-QeR09dZgUrMTwzuPVgCK+sSYAVt0ctDyq3jiLBh0Bf3/EltnNZczCeR0O2kkyoxXXbKX9GTELajjDvna7TsFDA==" data-copy data-copied></script>
<script src=/js/zoom.min.js></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="The Power of Observability"><meta property="og:description" content="In the dynamic landscape of modern software development, maintaining the health and performance of complex systems is paramount."><meta property="og:type" content="article"><meta property="og:url" content="https://aghandoura.github.io/posts/observability/"><meta property="og:image" content="https://aghandoura.github.io/posts/observability/featured.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-24T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-24T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://aghandoura.github.io/posts/observability/featured.png"><meta name=twitter:title content="The Power of Observability"><meta name=twitter:description content="In the dynamic landscape of modern software development, maintaining the health and performance of complex systems is paramount."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"The Power of Observability","headline":"The Power of Observability","abstract":"In the dynamic landscape of modern software development, maintaining the health and performance of complex systems is paramount.","inLanguage":"en","url":"https:\/\/aghandoura.github.io\/posts\/observability\/","author":{"@type":"Person","name":"Adam Ghandoura"},"copyrightYear":"2023","dateCreated":"2023-08-24T00:00:00\u002b00:00","datePublished":"2023-08-24T00:00:00\u002b00:00","dateModified":"2023-08-24T00:00:00\u002b00:00","keywords":["Observability","Kubernetes","k8s","Minikube","ELK","Elasticsearch","Kibana","Logstash","Filebeat","Metricbeat","Grafana","Loki","DevOps"],"mainEntityOfPage":"true","wordCount":"2045"}]</script><meta name=author content="Adam Ghandoura"><link href=mailto:adam.ghandoura@gmail.com rel=me><link href=https://twitter.com/gh_freeman rel=me><link href=https://instagram.com/gh_freeman rel=me><link href=https://github.com/aghandoura rel=me><link href=https://github.com/ghandoura rel=me><script src=/lib/jquery/jquery.slim.min.js integrity></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QQTQP7234K"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QQTQP7234K")</script><meta name=theme-color><script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js></script>
<script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js></script>
<script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js></script>
<script>const firebaseConfig={apiKey:"AIzaSyAGCE3R8lkc4L4yZ-b3o1TQJ4T_d7zkwLA",authDomain:"AIzaSyAGCE3R8lkc4L4yZ-b3o1TQJ4T_d7zkwLA",projectId:"aghandoura-blog",storageBucket:"aghandoura-blog.appspot.com",messagingSenderId:"595257894799",appId:"1:595257894799:web:ed08d4bba197338afd4dfa",measurementId:"G-QQTQP7234K"};var app=firebase.initializeApp(firebaseConfig),db=firebase.firestore(),auth=firebase.auth()</script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">aghandoura.github.com</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Posts>Blog</p></a><a href=/tags/ class="flex items-center"><p class="text-base font-medium text-gray-500 hover:text-gray-900" title=Tags>Tags</p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher aria-label="Dark mode switcher" type=button><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button style=margin-right:5px><div class="flex items-center justify-center h-12 dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden h-12 dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Posts>Blog</p></a></li><li class=mt-1><a href=/tags/ class="flex items-center"><p class="text-bg font-bg text-gray-500 hover:text-gray-900" title=Tags>Tags</p></a></li></ul></div></label></div></div><script>(function(){var e=$(".main-menu"),t=window.location.pathname;e.find('a[href="'+t+'"]').each(function(e,t){$(t).children("p").addClass("active")})})()</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div class="w-full h-36 md:h-56 lg:h-72 single_hero_basic nozoom" style=background-image:url(/posts/observability/featured.png)></div><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">The Power of Observability</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2023-08-24 00:00:00 +0000 UTC">24 August 2023</time><span class="px-2 text-primary-500">&#183;</span><span>2045 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">10 mins</span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=views_posts/observability/index.md title=views>0</span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span><span class="px-2 text-primary-500">&#183;</span><span>
<span id=likes_posts/observability/index.md title=likes>0</span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M47.6 300.4 228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6.0 115.2.0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg></span></span></span><span class="px-2 text-primary-500">&#183;</span><span>
<button id=likes_button class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400" onclick=process_article()>
<span id=likes_button_heart style=display:none class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M47.6 300.4 228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6.0 115.2.0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg></span></span><span id=likes_button_emtpty_heart class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M244 84l11.1 12 12-11.98C300.6 51.37 347 36.51 392.6 44.1 461.5 55.58 512 115.2 512 185.1V190.9c0 41.5-17.2 81.2-47.6 109.5L283.7 469.1c-7.5 7-17.4 10.9-27.7 10.9S235.8 476.1 228.3 469.1L47.59 300.4C17.23 272.1.0 232.4.0 190.9V185.1c0-69.9 50.52-129.52 119.4-141 44.7-7.59 92 7.27 124.6 39.9C243.1 84 244 84.01 244 84zm11.1 79.9-45-46.8c-21.7-20.82-52.5-30.7-82.8-25.66C81.55 99.07 48 138.7 48 185.1V190.9c0 28.2 11.71 55.2 32.34 74.4L256 429.3l175.7-164c20.6-19.2 32.3-46.2 32.3-74.4V185.1c0-46.4-33.6-86.03-79.3-93.66C354.4 86.4 323.6 96.28 301.9 117.1l-46.8 46.8z"/></svg></span></span><span id=likes_button_text>&nbsp;Like</span></button></span></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-10"><details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#understanding-observability-a-primer>Understanding Observability: A Primer</a><ul><li><a href=#diagnosing-issues>Diagnosing Issues</a></li><li><a href=#understanding-performance>Understanding Performance</a></li><li><a href=#proactive-monitoring>Proactive Monitoring</a></li><li><a href=#dynamic-environments>Dynamic Environments</a></li><li><a href=#end-to-end-insights>End-to-End Insights</a></li><li><a href=#service-level-agreements-slas>Service-Level Agreements (SLAs)</a></li><li><a href=#scalability>Scalability</a></li><li><a href=#reducing-downtime>Reducing Downtime</a></li><li><a href=#continuous-improvement>Continuous Improvement</a></li><li><a href=#data-driven-decisions>Data-Driven Decisions</a></li><li><a href=#security-and-compliance>Security and Compliance</a></li><li><a href=#feedback-loop>Feedback Loop</a></li></ul></li><li><a href=#tools-for-observability>Tools for Observability</a></li><li><a href=#design-patterns-for-observability-in-kubernetes>Design Patterns for Observability in Kubernetes</a></li><li><a href=#hands-on>Hands-on</a><ul><li><a href=#prerequisits>Prerequisits</a><ul><li><a href=#kubernetes-cluster>Kubernetes cluster</a></li><li><a href=#helm>Helm</a></li></ul></li><li><a href=#elk-stack-on-kubernetes>ELK Stack on Kubernetes</a><ul><li><a href=#deploy-elasticsearch>Deploy Elasticsearch</a></li><li><a href=#deploy-logstash>Deploy Logstash</a></li><li><a href=#deploy-kibana>Deploy Kibana</a></li><li><a href=#deploy-filebeat-and-metricbeat>Deploy Filebeat and Metricbeat</a></li></ul></li><li><a href=#login-to-kibana>Login to Kibana</a><ul><li><a href=#span-stylecolorred-elk-helm-charts-archived-span><span style=color:red>ELK Helm charts archived</span></a></li></ul></li><li><a href=#grafana-loki-stack>Grafana Loki-stack</a><ul><li><a href=#loki-stack>Loki stack</a></li></ul></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details><details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#understanding-observability-a-primer>Understanding Observability: A Primer</a><ul><li><a href=#diagnosing-issues>Diagnosing Issues</a></li><li><a href=#understanding-performance>Understanding Performance</a></li><li><a href=#proactive-monitoring>Proactive Monitoring</a></li><li><a href=#dynamic-environments>Dynamic Environments</a></li><li><a href=#end-to-end-insights>End-to-End Insights</a></li><li><a href=#service-level-agreements-slas>Service-Level Agreements (SLAs)</a></li><li><a href=#scalability>Scalability</a></li><li><a href=#reducing-downtime>Reducing Downtime</a></li><li><a href=#continuous-improvement>Continuous Improvement</a></li><li><a href=#data-driven-decisions>Data-Driven Decisions</a></li><li><a href=#security-and-compliance>Security and Compliance</a></li><li><a href=#feedback-loop>Feedback Loop</a></li></ul></li><li><a href=#tools-for-observability>Tools for Observability</a></li><li><a href=#design-patterns-for-observability-in-kubernetes>Design Patterns for Observability in Kubernetes</a></li><li><a href=#hands-on>Hands-on</a><ul><li><a href=#prerequisits>Prerequisits</a><ul><li><a href=#kubernetes-cluster>Kubernetes cluster</a></li><li><a href=#helm>Helm</a></li></ul></li><li><a href=#elk-stack-on-kubernetes>ELK Stack on Kubernetes</a><ul><li><a href=#deploy-elasticsearch>Deploy Elasticsearch</a></li><li><a href=#deploy-logstash>Deploy Logstash</a></li><li><a href=#deploy-kibana>Deploy Kibana</a></li><li><a href=#deploy-filebeat-and-metricbeat>Deploy Filebeat and Metricbeat</a></li></ul></li><li><a href=#login-to-kibana>Login to Kibana</a><ul><li><a href=#span-stylecolorred-elk-helm-charts-archived-span><span style=color:red>ELK Helm charts archived</span></a></li></ul></li><li><a href=#grafana-loki-stack>Grafana Loki-stack</a><ul><li><a href=#loki-stack>Loki stack</a></li></ul></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details><script>(function(){var t,e=$("#TableOfContents");if(e.length>0){t=$(window);function n(){var s,o=t.scrollTop(),i=$(".anchor"),n="";if(i.each(function(e,t){t=$(t),t.offset().top-$(window).height()/3<=o&&(n=t.attr("id"))}),s=e.find("a.active"),s.length==1&&s.eq(0).attr("href")=="#"+n)return!0;s.each(function(e,t){$(t).removeClass("active").siblings("ul").hide()}),e.find('a[href="#'+n+'"]').addClass("active"),e.find('a[href="#'+n+'"]').parentsUntil("#TableOfContents").each(function(e,t){$(t).children("a").parents("ul").show()})}t.on("scroll",n),$(document).ready(function(){e.find("a").parent("li").find("ul").hide(),n()})}})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="max-w-prose mb-20"><p>In the dynamic landscape of modern software development, maintaining the health and performance of complex systems is paramount. Enter <strong>observability</strong>, is a concept that has gained significant traction in recent years as applications become more intricate and distributed. In this blog post, we&rsquo;ll delve into what observability is, why it&rsquo;s crucial in a distributed system, and explore some popular tools and design patterns used to achieve observability. We then finish with a hands-on exercise of deploying an observability stack in <strong>Kubernetes</strong>.</p><div id=understanding-observability-a-primer class=anchor></div><h2 class="relative group">Understanding Observability: A Primer
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#understanding-observability-a-primer aria-label=Anchor>#</a></span></h2><p><strong>Observability</strong> refers to the capability of gaining insights into the internal states of a system by analyzing its external outputs. Unlike monitoring, which typically focuses on specific metrics, observability aims to provide a holistic view of a system&rsquo;s behavior and performance. This concept is particularly relevant in distributed systems due to the inherent complexity and challenges of managing and maintaining such systems. Following are some of its use cases highlighting its significance:</p><div id=diagnosing-issues class=anchor></div><h3 class="relative group">Diagnosing Issues
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#diagnosing-issues aria-label=Anchor>#</a></span></h3><p>In distributed systems, identifying the root causes of problems can prove exceedingly challenging. Observability steps in by providing insights into the interactions, dependencies, and various components at play, leading to quicker and more accurate troubleshooting efforts.</p><div id=understanding-performance class=anchor></div><h3 class="relative group">Understanding Performance
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#understanding-performance aria-label=Anchor>#</a></span></h3><p>Distributed systems can often fall prey to performance bottlenecks that may not be immediately apparent within individual components. Observability tools step in to closely monitor and analyze the holistic performance of the entire system, ensuring optimal user experiences.</p><div id=proactive-monitoring class=anchor></div><h3 class="relative group">Proactive Monitoring
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#proactive-monitoring aria-label=Anchor>#</a></span></h3><p>Observability allows for the proactive monitoring of systems. Rather than waiting for failures to manifest, teams can detect anomalies and unusual patterns early on, enabling swift action to mitigate potential issues before they escalate.</p><div id=dynamic-environments class=anchor></div><h3 class="relative group">Dynamic Environments
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#dynamic-environments aria-label=Anchor>#</a></span></h3><p>Given the prevalence of containers, microservices, and cloud resources, distributed systems frequently experience dynamic scaling. Observability tools are built to adapt to these fluctuations, offering insights into the ever-evolving infrastructure.</p><div id=end-to-end-insights class=anchor></div><h3 class="relative group">End-to-End Insights
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#end-to-end-insights aria-label=Anchor>#</a></span></h3><p>A comprehensive perspective of a distributed system is crucial in understanding how diverse components interact to deliver services. Observability provides these end-to-end insights, which are instrumental in maintaining seamless user experiences.</p><div id=service-level-agreements-slas class=anchor></div><h3 class="relative group">Service-Level Agreements (SLAs)
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#service-level-agreements-slas aria-label=Anchor>#</a></span></h3><p>Meeting SLAs can be a significant challenge in distributed systems. Observability comes to the rescue by closely monitoring metrics that directly impact SLAs, enabling teams to take corrective measures and avert violations.</p><div id=scalability class=anchor></div><h3 class="relative group">Scalability
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#scalability aria-label=Anchor>#</a></span></h3><p>As distributed systems expand, scalability becomes a top concern. Observability tools diligently track performance metrics as systems scale, ensuring the infrastructure remains capable of handling heightened workloads.</p><div id=reducing-downtime class=anchor></div><h3 class="relative group">Reducing Downtime
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#reducing-downtime aria-label=Anchor>#</a></span></h3><p>Armed with real-time insights and predictive analytics, observability contributes to minimizing downtime. By rapidly identifying issues and facilitating swift responses, it becomes a linchpin in sustaining uninterrupted operations.</p><div id=continuous-improvement class=anchor></div><h3 class="relative group">Continuous Improvement
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#continuous-improvement aria-label=Anchor>#</a></span></h3><p>Observability nurtures a culture of continuous improvement. Armed with historical data, teams can optimize performance, learn from past experiences, and make informed decisions for system enhancements.</p><div id=data-driven-decisions class=anchor></div><h3 class="relative group">Data-Driven Decisions
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#data-driven-decisions aria-label=Anchor>#</a></span></h3><p>The wealth of observability data becomes a valuable resource for data-driven decisions regarding resource allocation, infrastructure adjustments, and overarching architectural improvements.</p><div id=security-and-compliance class=anchor></div><h3 class="relative group">Security and Compliance
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#security-and-compliance aria-label=Anchor>#</a></span></h3><p>Observability tools extend their reach to encompass security event monitoring, audit log analysis, and activities tied to regulatory compliance. This translates to a more secure and compliant distributed system.</p><div id=feedback-loop class=anchor></div><h3 class="relative group">Feedback Loop
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#feedback-loop aria-label=Anchor>#</a></span></h3><p>An integral feedback loop is established between development and operations teams through observability. Developers gain valuable insights into the impact of their code on the system, expediting iterative development cycles and fostering ongoing improvements.</p><p>In essence, observability empowers engineering, DevOps teams, and system administrators with the insights necessary to ensure the stability, performance, and reliability of intricate distributed systems. This capability equips organizations to effectively manage the intricacies of contemporary architectures and deliver high-caliber services to end-users.</p><div id=tools-for-observability class=anchor></div><h2 class="relative group">Tools for Observability
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#tools-for-observability aria-label=Anchor>#</a></span></h2><ol><li><p><strong>Prometheus</strong>: A leading open-source monitoring and alerting toolkit, Prometheus scrapes metrics from various components in Kubernetes clusters. It stores and processes these metrics, allowing users to create custom dashboards and set up alerts based on defined thresholds.</p></li><li><p><strong>Grafana</strong>: Grafana complements Prometheus by offering a flexible visualization platform. It lets you create interactive, customizable dashboards that display Prometheus metrics and other data sources.</p></li><li><p><strong>Jaeger</strong>: For distributed tracing, Jaeger is a popular choice. It helps track requests as they flow through microservices, identifying latency bottlenecks and aiding in root cause analysis.</p></li><li><p><strong>Loki</strong>: A log aggregation system, Loki assists in storing and exploring logs. It works well with Kubernetes clusters and can be integrated with Prometheus for powerful log-based queries.</p></li><li><p><strong>Zipkin</strong>: Another distributed tracing system that helps gather timing data needed to troubleshoot latency problems in service architectures.</p></li><li><p><strong>ELK Stack (Elasticsearch, Logstash, Kibana)</strong>: Elasticsearch is used for storing and indexing logs, Logstash for collecting and processing logs, and Kibana for visualizing and exploring log data.</p></li><li><p><strong>Dynatrace</strong>: A comprehensive observability platform that provides APM, infrastructure monitoring, and real user monitoring (RUM) to give insights into application and infrastructure performance.</p></li><li><p><strong>Datadog</strong>: A cloud-based monitoring and analytics platform that offers APM, infrastructure monitoring, log management, and synthetic monitoring for distributed systems.</p></li><li><p><strong>Sysdig</strong>: A platform that provides container monitoring, security, and forensics capabilities for containerized and cloud-native environments.</p></li><li><p><strong>OpenTelemetry</strong>: An open-source project that provides APIs, libraries, agents, and instrumentation to enable observability in applications, helping to generate and collect distributed traces and metrics.</p></li><li><p><strong>Instana</strong>: A platform that automatically discovers and monitors applications, microservices, and infrastructure, providing real-time insights into the health and performance of distributed systems.</p></li><li><p><strong>Wavefront</strong>: A cloud-native monitoring and analytics platform that offers observability for applications, containers, and infrastructure through metrics, histograms, traces, and span data.</p></li><li><p><strong>New Relic</strong>: A commercial observability platform that offers application performance monitoring (APM), infrastructure monitoring, and synthetic testing capabilities for distributed systems.</p></li></ol><div id=design-patterns-for-observability-in-kubernetes class=anchor></div><h2 class="relative group">Design Patterns for Observability in Kubernetes
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#design-patterns-for-observability-in-kubernetes aria-label=Anchor>#</a></span></h2><ol><li><p><strong>Instrumentation</strong>: Injecting code into applications to generate relevant metrics, logs, and traces. This can be done using libraries or frameworks tailored to your language.</p></li><li><p><strong>Sidecar Pattern</strong>: Deploying a separate container (sidecar) within the same pod as your application container to collect metrics, logs, or traces. This approach avoids interfering with your app&rsquo;s core logic.</p></li><li><p><strong>Adapter Pattern</strong>: Using an adapter to convert telemetry data from one format to another. For instance, converting application logs into metrics that can be easily analyzed.</p></li><li><p><strong>Golden Signals</strong>: Monitoring four key metrics—latency, traffic, errors, and saturation—to gain a comprehensive understanding of system health and performance.</p></li><li><p><strong>Service Mesh</strong>: Implementing a service mesh like Istio or Linkerd can help manage observability tasks like tracing, traffic control, and encryption, across your microservices architecture.</p></li></ol><div id=hands-on class=anchor></div><h2 class="relative group">Hands-on
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#hands-on aria-label=Anchor>#</a></span></h2><p>We explore two observability stacks in Kubernetes first ELK and then we incrementally build one using Grafana tools.</p><p><strong><em>NOTE:</em></strong> Instructions in this section are intended for testing and evalutation only and do not satisfy most of production requirements.</p><div id=prerequisits class=anchor></div><h3 class="relative group">Prerequisits
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#prerequisits aria-label=Anchor>#</a></span></h3><div id=kubernetes-cluster class=anchor></div><h4 class="relative group">Kubernetes cluster
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#kubernetes-cluster aria-label=Anchor>#</a></span></h4><p>In this Hands-on we will be using a <a href=https://github.com/kubernetes-sigs/kubespray target=_blank>kubespray</a> cluster. Minikube can be used instead.</p><img src=gallery/kubespray.png alt=kubespary style=width:200px><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt;kubectl get nodes
</span></span><span class=line><span class=cl>NAME    STATUS   ROLES           AGE     VERSION
</span></span><span class=line><span class=cl>kub-1   Ready    control-plane   2d23h   v1.27.4
</span></span><span class=line><span class=cl>kub-2   Ready    &lt;none&gt;          2d23h   v1.27.4
</span></span><span class=line><span class=cl>kub-3   Ready    &lt;none&gt;          2d23h   v1.27.4
</span></span></code></pre></div><div id=helm class=anchor></div><h4 class="relative group">Helm
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#helm aria-label=Anchor>#</a></span></h4><img src=gallery/helm.png alt=helm style=width:100px;height:100px><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
</span></span><span class=line><span class=cl>&gt; chmod <span class=m>700</span> get_helm.sh
</span></span><span class=line><span class=cl>&gt; ./get_helm.sh
</span></span></code></pre></div><div id=elk-stack-on-kubernetes class=anchor></div><h3 class="relative group">ELK Stack on Kubernetes
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#elk-stack-on-kubernetes aria-label=Anchor>#</a></span></h3><img src=gallery/elk.png alt=helm style=width:400px;height:200px><div id=deploy-elasticsearch class=anchor></div><h4 class="relative group">Deploy Elasticsearch
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#deploy-elasticsearch aria-label=Anchor>#</a></span></h4><p>In my cluster, I am using Rancher <a href=https://github.com/rancher/local-path-provisioner target=_blank>local path provisioner</a></p><p>Create values.yaml</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Shrink default JVM heap.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>esJavaOpts</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;-Xmx128m -Xms128m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Allocate smaller chunks of memory per pod.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;100m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;512M&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>limits</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1000m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;512M&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Request smaller persistent volumes and use &#34;local-path&#34; as storageClassName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumeClaimTemplate</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;ReadWriteOnce&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;local-path&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>100M</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt;helm repo add elastic https://helm.elastic.co
</span></span><span class=line><span class=cl>&gt;helm install elasticsearch elastic/elasticsearch -f ./values.yaml --namespace<span class=o>=</span>elk --namespace<span class=o>=</span>elk   --create-namespace --wait
</span></span></code></pre></div><p>For <code>Minikube</code> make sure to enable <code>storage-provisioner</code> addon:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt;minikube addons <span class=nb>enable</span> default-storageclass
</span></span><span class=line><span class=cl>&gt;minikube addons <span class=nb>enable</span> storage-provisioner
</span></span></code></pre></div><p>Use the example <a href=https://raw.githubusercontent.com/LianDuanTrain/Helm3/master/3%20Helm%20Deep%20Dive/elasticsearch/minikube/values.yaml target=_blank>value.yaml</a> from the helm repo.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt;wget https://raw.githubusercontent.com/LianDuanTrain/Helm3/master/3%20Helm%20Deep%20Dive/elasticsearch/minikube/values.yaml
</span></span><span class=line><span class=cl>&gt;helm install elasticsearch elastic/elasticsearch -f ./value.yaml --namespace<span class=o>=</span>elk   --create-namespace --wait
</span></span></code></pre></div><p>Verify running pods:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt;kubectl get pods -n
</span></span><span class=line><span class=cl>NAME                     READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>elasticsearch-master-0   1/1     Running   <span class=m>0</span>          8m52s
</span></span><span class=line><span class=cl>elasticsearch-master-1   1/1     Running   <span class=m>0</span>          8m52s
</span></span><span class=line><span class=cl>elasticsearch-master-2   1/1     Running   <span class=m>0</span>          8m52s
</span></span></code></pre></div><p>Expose service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt;kubectl port-forward -n elk svc/elasticsearch-master <span class=m>9200</span>
</span></span></code></pre></div><p>Get elastic username and password</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt;kubectl get secrets --namespace<span class=o>=</span>elk elasticsearch-master-credentials -ojsonpath<span class=o>=</span><span class=s1>&#39;{.data.username}&#39;</span> <span class=p>|</span> base64 -d
</span></span><span class=line><span class=cl>&gt;kubectl get secrets --namespace<span class=o>=</span>elk elasticsearch-master-credentials -ojsonpath<span class=o>=</span><span class=s1>&#39;{.data.password}&#39;</span> <span class=p>|</span> base64 -d
</span></span></code></pre></div><p>Replace <code>username</code> and <code>password</code> in the curl command with the values from the commands above.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt;curl -u &lt;username&gt;:&lt;password&gt;-i -H <span class=s1>&#39;Accept:application/json&#39;</span> https://localhost:9200 -k
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>X-elastic-product: Elasticsearch
</span></span><span class=line><span class=cl>content-type: application/json
</span></span><span class=line><span class=cl>content-length: <span class=m>548</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;name&#34;</span> : <span class=s2>&#34;elasticsearch-master-1&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;cluster_name&#34;</span> : <span class=s2>&#34;elasticsearch&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;cluster_uuid&#34;</span> : <span class=s2>&#34;r6d0vqVEQ7usXXSpKjBxgA&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;version&#34;</span> : <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;number&#34;</span> : <span class=s2>&#34;8.5.1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;build_flavor&#34;</span> : <span class=s2>&#34;default&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;build_type&#34;</span> : <span class=s2>&#34;docker&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;build_hash&#34;</span> : <span class=s2>&#34;c1310c45fc534583afe2c1c03046491efba2bba2&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;build_date&#34;</span> : <span class=s2>&#34;2022-11-09T21:02:20.169855900Z&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;build_snapshot&#34;</span> : false,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;lucene_version&#34;</span> : <span class=s2>&#34;9.4.1&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;minimum_wire_compatibility_version&#34;</span> : <span class=s2>&#34;7.17.0&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;minimum_index_compatibility_version&#34;</span> : <span class=s2>&#34;7.0.0&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;tagline&#34;</span> : <span class=s2>&#34;You Know, for Search&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div id=deploy-logstash class=anchor></div><h4 class="relative group">Deploy Logstash
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#deploy-logstash aria-label=Anchor>#</a></span></h4><p>Create values.yaml or <a href=https://raw.githubusercontent.com/elastic/helm-charts/main/logstash/examples/elasticsearch/values.yaml target=_blank>download it</a> from Logstash helm-repo</p><p>I had to modify the storageclass template and request reduced resources requirements see below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>persistence</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>logstashConfig</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logstash.yml</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    http.host: 0.0.0.0
</span></span></span><span class=line><span class=cl><span class=sd>    xpack.monitoring.enabled: false</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>logstashPipeline</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>uptime.conf</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    input { exec { command =&gt; &#34;uptime&#34; interval =&gt; 30 } }
</span></span></span><span class=line><span class=cl><span class=sd>    output {
</span></span></span><span class=line><span class=cl><span class=sd>      elasticsearch {
</span></span></span><span class=line><span class=cl><span class=sd>        hosts =&gt; [&#34;https://elasticsearch-master:9200&#34;]
</span></span></span><span class=line><span class=cl><span class=sd>        user =&gt; &#39;${ELASTICSEARCH_USERNAME}&#39;
</span></span></span><span class=line><span class=cl><span class=sd>        cacert =&gt; &#39;/usr/share/logstash/config/certs/ca.crt&#39;
</span></span></span><span class=line><span class=cl><span class=sd>        password =&gt; &#39;${ELASTICSEARCH_PASSWORD}&#39;
</span></span></span><span class=line><span class=cl><span class=sd>        index =&gt; &#34;logstash&#34;
</span></span></span><span class=line><span class=cl><span class=sd>      }
</span></span></span><span class=line><span class=cl><span class=sd>    }</span><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>extraEnvs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ELASTICSEARCH_USERNAME&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>elasticsearch-master-credentials</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>username</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;ELASTICSEARCH_PASSWORD&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>elasticsearch-master-credentials</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>password</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>secretMounts</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>elasticsearch-master-certs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class=l>elasticsearch-master-certs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/usr/share/logstash/config/certs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Shrink default JVM heap.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>logstashJavaOpts</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;-Xmx512m -Xms512m&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Request smaller persistent volumes.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumeClaimTemplate</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;ReadWriteOnce&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>storageClassName</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;local-path&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>1Gi</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt;helm install logstash elastic/logstash -f ./values.yaml --namespace<span class=o>=</span>elk --wait
</span></span></code></pre></div><p>Verify service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt;kubectl port-forward svc/elasticsearch-master <span class=m>9200</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>&gt;curl localhost:9200/_cat/indices
</span></span><span class=line><span class=cl>Handling connection <span class=k>for</span> <span class=m>8080</span>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>X-elastic-product: Elasticsearch
</span></span><span class=line><span class=cl>content-type: application/json
</span></span><span class=line><span class=cl>content-length: <span class=m>191</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[{</span><span class=s2>&#34;health&#34;</span>:<span class=s2>&#34;green&#34;</span>,<span class=s2>&#34;status&#34;</span>:<span class=s2>&#34;open&#34;</span>,<span class=s2>&#34;index&#34;</span>:<span class=s2>&#34;logstash&#34;</span>,<span class=s2>&#34;uuid&#34;</span>:<span class=s2>&#34;CT54vcBoR0qx4t0PEy4_Rg&#34;</span>,<span class=s2>&#34;pri&#34;</span>:<span class=s2>&#34;1&#34;</span>,<span class=s2>&#34;rep&#34;</span>:<span class=s2>&#34;1&#34;</span>,<span class=s2>&#34;docs.count&#34;</span>:<span class=s2>&#34;2&#34;</span>,<span class=s2>&#34;docs.deleted&#34;</span>:<span class=s2>&#34;0&#34;</span>,<span class=s2>&#34;store.size&#34;</span>:<span class=s2>&#34;33.9kb&#34;</span>,<span class=s2>&#34;pri.store.size&#34;</span>:<span class=s2>&#34;16.9kb&#34;</span><span class=o>}]</span>⏎  
</span></span></code></pre></div><div id=deploy-kibana class=anchor></div><h4 class="relative group">Deploy Kibana
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#deploy-kibana aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt;helm install kibana elastic/kibana --namespace<span class=o>=</span>elk  
</span></span></code></pre></div><div id=deploy-filebeat-and-metricbeat class=anchor></div><h4 class="relative group">Deploy Filebeat and Metricbeat
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#deploy-filebeat-and-metricbeat aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm install filebeat elastic/filebea --namespace<span class=o>=</span>elk
</span></span></code></pre></div><div id=login-to-kibana class=anchor></div><h3 class="relative group">Login to Kibana
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#login-to-kibana aria-label=Anchor>#</a></span></h3><p>We first need to expose the Kibana service, this can be done using <code>kubectl port-forward</code> or an <code>ingress</code>&mldr; Here we just edit the Kibana service to be a NodePort:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=l>kubectl get svc -n elk kibana-kibana -o yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>meta.helm.sh/release-name</span><span class=p>:</span><span class=w> </span><span class=l>kibana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>meta.helm.sh/release-namespace</span><span class=p>:</span><span class=w> </span><span class=l>elk</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2023-08-24T16:12:23Z&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>kibana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app.kubernetes.io/managed-by</span><span class=p>:</span><span class=w> </span><span class=l>Helm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>heritage</span><span class=p>:</span><span class=w> </span><span class=l>Helm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>release</span><span class=p>:</span><span class=w> </span><span class=l>kibana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>kibana-kibana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>elk</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resourceVersion</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;509386&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>uid</span><span class=p>:</span><span class=w> </span><span class=l>3dd813f1-e900-4e50-a054-ebc8aeaff529</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clusterIP</span><span class=p>:</span><span class=w> </span><span class=m>10.233.44.71</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clusterIPs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=m>10.233.44.71</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>externalTrafficPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>internalTrafficPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ipFamilies</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>IPv4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ipFamilyPolicy</span><span class=p>:</span><span class=w> </span><span class=l>SingleStack</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>5601</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>5601</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>kibana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>release</span><span class=p>:</span><span class=w> </span><span class=l>kibana</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>sessionAffinity</span><span class=p>:</span><span class=w> </span><span class=l>None</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>loadBalancer</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=/posts/observability/gallery/kibana-login.png alt=kibana-login></figure></p><p><code>Username</code>: elastic
`Password``: can be retreived using the command below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get secrets --namespace<span class=o>=</span>elk elasticsearch-master-credentials -ojsonpath<span class=o>=</span><span class=s1>&#39;{.data.password}&#39;</span> <span class=p>|</span> base64 -d
</span></span></code></pre></div><p>After login navigate to Observability, Logs and Metrics should be available</p><p><figure><img class="my-0 rounded-md" src=/posts/observability/gallery/kibana-observability.png alt=kibana-observability></figure></p><p><strong><em>NOTE:</em></strong> ELK is a powerhouse with many features, maybe a bit too much for some usecases. as a result it comes with a big performance requirements, had to run it with reduced ram and still had to increase ram for my VMs twice, There is probably a way to optimize it I didn&rsquo;t look into the documentation for that.</p><div id=span-stylecolorred-elk-helm-charts-archived-span class=anchor></div><h4 class="relative group"><span style=color:red>ELK Helm charts archived</span>
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#span-stylecolorred-elk-helm-charts-archived-span aria-label=Anchor>#</a></span></h4><p>Elastic stack helm charts <a href=https://github.com/elastic/helm-charts/issues/1731 target=_blank>github repository</a> has been archived. with a recommendation to use Elastic Cloud on Kubernetes (ECK).</p><div id=grafana-loki-stack class=anchor></div><h3 class="relative group">Grafana Loki-stack
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#grafana-loki-stack aria-label=Anchor>#</a></span></h3><p>Sometimes all you need is aggregated logs and the ability to run some queries to build your dashboard for that Loki-stack gets the job done.</p><p>Add grafana helm-charts repo</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm repo add grafana https://grafana.github.io/helm-charts
</span></span><span class=line><span class=cl>helm repo update
</span></span></code></pre></div><div id=loki-stack class=anchor></div><h4 class="relative group">Loki stack
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#loki-stack aria-label=Anchor>#</a></span></h4><p>You can check Loki-stack default values:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl> helm show values grafana/loki-stack &gt; values.yaml
</span></span></code></pre></div><p>We use fluent-bit to collect logs and send them to loki and then display using grafana:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>helm upgrade --install loki grafana/loki-stack <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>     --set grafana.enabled<span class=o>=</span>true,fluent-bit.enabled<span class=o>=</span>true,promtail.enabled<span class=o>=</span><span class=nb>false</span> -n loki --create-namespace
</span></span></code></pre></div><p>Expose grafana service as nodeport:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl patch svc -n loki loki-grafana --type<span class=o>=</span><span class=s1>&#39;json&#39;</span> -p <span class=s1>&#39;[{&#34;op&#34;:&#34;replace&#34;,&#34;path&#34;:&#34;/spec/type&#34;,&#34;value&#34;:&#34;NodePort&#34;}]&#39;</span>
</span></span><span class=line><span class=cl>kubectl get svc -n loki
</span></span></code></pre></div><p>Get grafana admin password</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl get secret --namespace loki loki-grafana -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&#34;{.data.admin-password}&#34;</span> <span class=p>|</span> base64 --decode <span class=p>;</span> <span class=nb>echo</span>
</span></span></code></pre></div><p><figure><img class="my-0 rounded-md" src=/posts/observability/gallery/grafana_login.png alt="grafana login"></figure></p><p>Loki datasource should already be configured if you enabled grafana when installing loki-stack, if you&rsquo;re using your own grafana deployment make sure to add Loki datasource:</p><p><figure><img class="my-0 rounded-md" src=/posts/observability/gallery/loki-datasource.png alt="loki data source"></figure></p><p>Now you can use Log Browser to build grafana panels, or used <a href=https://grafana.com/docs/loki/latest/logql/ target=_blank>LogQL</a> to do more advanced queries<figure><img class="my-0 rounded-md" src=/posts/observability/gallery/log-browser.png alt=log-browser></figure></p><div id=conclusion class=anchor></div><h2 class="relative group">Conclusion
<span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#conclusion aria-label=Anchor>#</a></span></h2><p>Observability is not just a buzzword; it&rsquo;s a fundamental practice for maintaining and enhancing the performance of complex Kubernetes environments. By employing tools like ELK, Prometheus, Grafana, Jaeger, and Loki, and leveraging design patterns such as instrumentation, sidecar, and adapter, you can build a robust observability strategy that empowers your DevOps team to identify, diagnose, and rectify issues efficiently. As Kubernetes continues to be a cornerstone of modern infrastructure, embracing observability is a strategic move that ensures the seamless operation of your applications and services.</p><div id=graphcomment></div><script type=text/javascript>var __semio__params={graphcommentId:"aghandoura",behaviour:{}};function __semio__onload(){__semio__gc_graphlogin(__semio__params)}(function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.onload=__semio__onload,e.defer=!0,e.src="https://integration.graphcomment.com/gc_graphlogin.js?"+Date.now(),(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script></div></div><script>var oid="views_posts/observability/index.md",oid_likes="likes_posts/observability/index.md"</script><script type=text/javascript src=/js/page.min.0e49973b4ad0a382c7c6012d8bff8226316642daabc4f8a20477bd08674f3da6e2fa993bc20ad4f51e7c5bb68e6f913a207a7c4fe37ea0e7b806894afce0a64e.js integrity="sha512-DkmXO0rQo4LHxgEti/+CJjFmQtqrxPiiBHe9CGdPPabi+pk7wgrU9R58W7aOb5E6IHp8T+N+oOe4BolK/OCmTg=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/traefik-kubernetes/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Exploring Traefik in kubernetes</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2023-08-14 00:00:00 +0000 UTC">14 August 2023</time></span></span></a></span>
<span></span></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2023
Adam Ghandoura</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.35c1113bcc16c5a59bf031082f9e63822aa95280423881a7847a7ff33a16e6299ce6a840d9ef4e10d947e030a18f3f20359afb2ec0f35967484b9a9360ac3145.js integrity="sha512-NcERO8wWxaWb8DEIL55jgiqpUoBCOIGnhHp/8zoW5imc5qhA2e9OENlH4DChjz8gNZr7LsDzWWdIS5qTYKwxRQ=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://aghandoura.github.io/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=aghandoura data-description="Support me on Buy me a coffee!" data-message data-color=#FFDD00 data-position=Left data-x_margin=18 data-y_margin=18></script></html>